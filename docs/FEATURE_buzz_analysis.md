# バズ分析強化 設計書

## 概要
ER上位投稿の共通パターンを自動抽出し、
「何をどう書けばバズるか」を具体的に提示する。
現状のAI分析を大幅に強化する。

---

## 現状の課題
- AI分析レポートが汎用的すぎる（「エンゲージメントを高めましょう」程度）
- 投稿データとAI分析が分離している
- 数値的な裏付けが弱い

---

## 分析ロジック（サーバー側: Analytics.js に追加）

### analyzeBuzzPattern(days)
1. 直近 days 日の全投稿を取得
2. ER（エンゲージメント率）で降順ソート
3. 上位10投稿と下位10投稿を分離
4. 以下の軸で統計を算出:

| 分析軸 | 算出内容 |
|---|---|
| 文字数 | 上位平均 vs 下位平均 |
| 投稿時間帯 | 上位の最頻時間帯 |
| 曜日 | 上位の最頻曜日 |
| メディア有無 | 上位のメディア添付率 vs 下位 |
| ハッシュタグ数 | 上位平均 vs 下位平均 |
| 質問形式（?含む） | 上位の質問率 vs 下位 |
| 1行目の文字数 | 上位平均 vs 下位平均（フック長） |

5. 結果オブジェクトを返す:
Copy
{ topPosts: [...], // ER上位10件（テキスト抜粋+指標） stats: { avgLength: { top: 120, bottom: 45 }, bestHour: 21, bestDay: '水曜', mediaRate: { top: 0.7, bottom: 0.2 }, questionRate: { top: 0.6, bottom: 0.1 }, avgHookLength: { top: 28, bottom: 15 } }, sampleSize: { total: 87, top: 10, bottom: 10 } }


### generateBuzzReport(days)
1. analyzeBuzzPattern(days) でデータ取得
2. Gemini API に以下のプロンプトで要約を依頼:

以下はThreadsアカウントの投稿分析データです。 バズった投稿（ER上位）とそうでない投稿の統計的な違いを分析し、 具体的で実行可能なアドバイスを3〜5個、日本語で提示してください。

データ: {stats JSON}

トップ投稿サンプル: {topPosts の先頭5件}

出力形式:

バズ条件の要約（1文）
具体的アドバイス（箇条書き）
次に試すべき投稿テーマの提案（3つ）

---

## クライアント側（screen_analytics.html「投稿分析」タブに追加）

### UI配置
- 投稿一覧の上部にカード追加
- 「📊 バズパターン分析」ボタン
- 期間選択: 30日 / 60日 / 90日

### 結果表示
┌─────────────────────────────────┐ │ 🔥 あなたのバズ条件 │ │ │ │ 📝 文字数: 100〜150字が最適 │ │ 🕐 時間帯: 21時台が最強 │ │ 📅 曜日: 水・金が高ER │ │ 📷 メディア: 画像付きで3.5倍 │ │ ❓ 質問形式: ER +40% │ │ 🎯 フック: 25〜30字で引きが最適 │ │ │ │ ── AI分析レポート ── │ │ (Gemini生成テキスト) │ │ │ │ 💡 次に試すテーマ: │ │ 1. ○○○ │ │ 2. ○○○ │ │ 3. ○○○ │ └─────────────────────────────────┘


### 数値の表示方法
- 上位 vs 下位を横棒グラフで比較（CSSのみ）
- 差が大きい項目ほど色を強調（--success / --error）
- 各項目にミニアイコン

---

## API変更

### processApiRequest に追加
- action: 'analyzeBuzzPattern' → Analytics.analyzeBuzzPattern(params.days)
- action: 'generateBuzzReport' → Analytics.generateBuzzReport(params.days)

---

## テスト項目
- [ ] 投稿が10件未満の場合のフォールバック表示
- [ ] 投稿が0件の場合のエラーハンドリング
- [ ] 30/60/90日の切替が正しく動作
- [ ] Gemini APIキー未設定時は統計のみ表示（AI部分はスキップ）
- [ ] ダークモードでグラフの色が適切
- [ ] 分析結果のキャッシュ（同日2回目はキャッシュから返す）
