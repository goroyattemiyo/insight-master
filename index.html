<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="InsightMaster">
  <link rel="apple-touch-icon" href="https://files.catbox.moe/up3cd1.webp">
    <link rel="icon" type="image/webp" href="https://files.catbox.moe/up3cd1.webp">
  <?!= HtmlService.createHtmlOutputFromFile('styles').getContent(); ?>
  <!-- ★FIX BUG-1: 二重includeを削除（この行のみ残す） -->
</head>
<body>  <!-- ステージ2: ロゴアニメーション -->
  <div id="splash" style="
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:linear-gradient(135deg,#0a0a1a 0%,#1a1a3e 30%,#2d1b69 60%,#1a1a3e 100%);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    z-index:9999;opacity:1;transition:opacity 0.6s ease-out;
  ">
    <style>
      @keyframes logoFloat {
        0% { opacity:0; transform:scale(0.3) translateY(40px); filter:blur(20px); }
        50% { opacity:1; transform:scale(1.05) translateY(-5px); filter:blur(0); }
        70% { transform:scale(0.98) translateY(2px); }
        100% { opacity:1; transform:scale(1) translateY(0); filter:blur(0); }
      }
      @keyframes titleReveal {
        0% { opacity:0; letter-spacing:20px; filter:blur(10px); }
        60% { opacity:1; letter-spacing:4px; filter:blur(0); }
        100% { opacity:1; letter-spacing:2px; }
      }
      @keyframes subtitleFade {
        0% { opacity:0; transform:translateY(15px); }
        100% { opacity:1; transform:translateY(0); }
      }
      @keyframes lineExpand {
        0% { width:0; opacity:0; }
        100% { width:120px; opacity:1; }
      }
      @keyframes dotPulse {
        0%,100% { opacity:0.3; transform:scale(0.8); }
        50% { opacity:1; transform:scale(1.2); }
      }
      @keyframes glowPulse {
        0%,100% { box-shadow:0 0 20px rgba(102,126,234,0.3),0 0 60px rgba(118,75,162,0.1); }
        50% { box-shadow:0 0 40px rgba(102,126,234,0.6),0 0 80px rgba(118,75,162,0.3); }
      }
      .splash-logo {
        width:100px;height:100px;border-radius:24px;
        animation:logoFloat 1.2s cubic-bezier(0.34,1.56,0.64,1) forwards,
                  glowPulse 2s ease-in-out 1.2s infinite;
        opacity:0;
      }
      .splash-title {
        color:#fff;font-size:24px;font-weight:700;margin-top:28px;
        animation:titleReveal 1s ease-out 0.6s forwards;opacity:0;
      }
      .splash-line {
        height:2px;margin-top:16px;border:none;
        background:linear-gradient(90deg,transparent,#667eea,#764ba2,transparent);
        animation:lineExpand 0.8s ease-out 1.2s forwards;width:0;opacity:0;
      }
      .splash-subtitle {
        color:rgba(255,255,255,0.6);font-size:13px;margin-top:14px;
        animation:subtitleFade 0.6s ease-out 1.6s forwards;opacity:0;
      }
      .splash-dots { display:flex;gap:8px;margin-top:32px; }
      .splash-dot {
        width:6px;height:6px;border-radius:50%;background:#667eea;
        animation:dotPulse 1.2s ease-in-out infinite;
      }
      .splash-dot:nth-child(2) { animation-delay:0.2s; }
      .splash-dot:nth-child(3) { animation-delay:0.4s; }
    </style>
    <img src="https://files.catbox.moe/up3cd1.webp" class="splash-logo">
    <div class="splash-title" style="font-family:'Inter',sans-serif;">Insight Master</div>
    <hr class="splash-line">
    <div class="splash-subtitle">Threads Analytics & AI Assistant</div>
    <div class="splash-dots">
      <div class="splash-dot"></div>
      <div class="splash-dot"></div>
      <div class="splash-dot"></div>
    </div>
  </div>
  <div id="app" style="display:none;opacity:0;transition:opacity 0.3s ease;">
    <div class="loading"><div class="loading-spinner"></div><div>読み込み中...</div></div>
  </div>
<script>
  window.SERVER_DATA = <?!= serverData ?>;
  window.APP_CONFIG = { deploymentUrl: '<?= deploymentUrl ?>' };
  (function() {
    var appReady = false;
    var startedAt = Date.now();
    var minShowMs = 2000;
    var autoFadeMs = 2500;
    var maxWaitMs = 5000;
    var ended = false;

    function endSplashNow() {
      if (ended) return;
      ended = true;
      var splash = document.getElementById('splash');
      var app = document.getElementById('app');
      if (splash.style.display === 'none') return;
      splash.style.opacity = '0';
      setTimeout(function() {
        splash.style.display = 'none';
        app.style.display = 'block';
        requestAnimationFrame(function() { requestAnimationFrame(function() { app.style.opacity = '1'; }); });
      }, 600);
    }

    function requestEnd() {
      var elapsed = Date.now() - startedAt;
      var wait = Math.max(0, minShowMs - elapsed);
      setTimeout(function() { endSplashNow(); }, wait);
    }

    // auto start and auto fade
    setTimeout(function() { endSplashNow(); }, autoFadeMs);
    setTimeout(function() { endSplashNow(); }, maxWaitMs);

    window.endSplash = function() {
      appReady = true;
      requestEnd();
    };
  })();
</script>
  <?!= HtmlService.createHtmlOutputFromFile('app_core').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('app_ui').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('app_init').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('screen_dashboard').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('screen_analytics').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('screen_generate').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('screen_keywords').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('screen_drafts').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('screen_settings').getContent(); ?>
</body>
</html>

